(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/index/binding"],{"1ed7":function(e,n,t){"use strict";t.r(n);var o=t("fdc7"),c=t.n(o);for(var i in o)"default"!==i&&function(e){t.d(n,e,(function(){return o[e]}))}(i);n["default"]=c.a},"2b43":function(e,n,t){"use strict";var o=t("a68c"),c=t.n(o);c.a},"45d2":function(e,n,t){},"45f6":function(e,n,t){"use strict";t.r(n);var o=t("e12b"),c=t("1ed7");for(var i in c)"default"!==i&&function(e){t.d(n,e,(function(){return c[e]}))}(i);t("2b43"),t("d3b4"),t("8a3f");var a,s=t("f0c5"),r=Object(s["a"])(c["default"],o["b"],o["c"],!1,null,"24baca92",null,!1,o["a"],a);n["default"]=r.exports},"8a3f":function(e,n,t){"use strict";var o=t("45d2"),c=t.n(o);c.a},a68c:function(e,n,t){},ac2b:function(e,n,t){},d3b4:function(e,n,t){"use strict";var o=t("ac2b"),c=t.n(o);c.a},d56d:function(e,n,t){"use strict";(function(e){t("ebc2");o(t("66fd"));var n=o(t("45f6"));function o(e){return e&&e.__esModule?e:{default:e}}wx.__webpack_require_UNI_MP_PLUGIN__=t,e(n.default)}).call(this,t("543d")["createPage"])},e12b:function(e,n,t){"use strict";var o;t.d(n,"b",(function(){return c})),t.d(n,"c",(function(){return i})),t.d(n,"a",(function(){return o}));var c=function(){var e=this,n=e.$createElement;e._self._c},i=[]},fdc7:function(e,n,t){"use strict";(function(e){Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;var t={data:function(){return{inArray:[],index:0,address:"",lydeviceId:"",children_name:"",aswitch:!0,deviceId:"",ipment:"",stateid:"",lyswitch:!1,user_phone:"",record:1,debounce:!0,interval:"",jsq:1}},onReady:function(){},onLoad:function(){},onShow:function(){this.obtain()},onHide:function(){clearInterval(this.interval)},onUnload:function(){clearInterval(this.interval)},methods:{climask:function(){this.lyswitch=!1},obtain:function(){this.record=1;var n=e.getStorageSync("mac_address");this.deviceId=n,this.user_phone=e.getStorageSync("user_phone");var t=getApp();this.stateid=t.globalData.stateid},connect:function(){getApp();if(this.user_phone){var e=this;console.log(e.debounce,"未进入if判断"),e.debounce&&(e.record=1,e.debounce=!1,e.connectDevice())}else this.lyswitch=!0},chronology:function(){var n=this,t=setInterval((function(){if(n.record++,2==n.stateid&&clearInterval(t),n.record>=15&&2!=n.stateid){clearInterval(t),n.record=1,e.stopBluetoothDevicesDiscovery({success:function(e){console.log("连接失败")}}),e.showToast({title:"请折起静腿并重新打开后再次连接",icon:"none",duration:5e3}),n.debounce=!0;var o=e.getStorageSync("counting");if(console.log("外部con",o),o>=2)e.removeStorageSync("mac_address"),e.removeStorageSync("user_phone"),n.user_phone="",n.mac_address="",e.setStorageSync("counting",1);else{var c=o+1;console.log(c,"unt---\x3ecounting"),e.setStorageSync("counting",c)}}}),1e3);n.interval=t},mitlog:function(){var e=this;/^1[3456789]\d{9}$/.test(this.user_phone)?this.$http.glassesEst({url:"users/children",method:"GET",data:{phone:this.user_phone}}).then((function(n){if(200==n.data.status){var t=n.data.data.children.length-1;n.data.data.children[t].mac_address?(e.$common.setStorage("user_phone",e.user_phone),e.$common.setStorage("mac_address",n.data.data.children[t].mac_address),e.deviceId=n.data.data.children[t].mac_address,e.connectDevice()):e.$common.navigator("/pages/lanya/blebinding?user_phone="+e.user_phone)}else e.$common.navigator("/pages/lanya/blebinding?user_phone="+e.user_phone);e.lyswitch=!1})):this.$common.showToast("请输入正确手机号")},connectDevice:function(){var n=this;console.log("进入1"),e.openBluetoothAdapter({success:function(e){n.findBlue()},fail:function(t){e.showToast({title:"请打开蓝牙",type:"error",icon:"none"}),n.record=1,n.debounce=!0}})},findBlue:function(){var n=this;n.chronology(),console.log("进入2"),e.startBluetoothDevicesDiscovery({allowDuplicatesKey:!1,interval:0,success:function(t){e.showLoading({title:"正在搜索设备"}),n.getBlue()},fail:function(e){var n=this;n.record=1,n.debounce=!0}})},getBlue:function(){var n=this;console.log("进入3",n.deviceId),e.onBluetoothDeviceFound((function(){e.getBluetoothDevices({success:function(e){for(var t=0;t<e.devices.length;t++)e.devices[t].deviceId==n.deviceId&&n.connetBlue(n.deviceId)},fail:function(){var e=this;e.record=1,e.debounce=!0,e.$common.showToast("搜索蓝牙设备失败")}})}))},connetBlue:function(){console.log("进入4");var n=this;e.createBLEConnection({deviceId:n.deviceId,success:function(t){e.showToast({title:"连接成功",icon:"fails",duration:800});var o=getApp();o.globalData.stateid=2,n.stateid=2,e.stopBluetoothDevicesDiscovery({success:function(e){console.log("连接蓝牙成功之后关闭蓝牙搜索")}}),n.record=1,n.debounce=!0,n.testing()},fail:function(){n.record=1,n.debounce=!0}})},testing:function(){console.log("进入5");var n=this;e.onBLEConnectionStateChange((function(e){if(0==e.connected){n.record=1,n.debounce=!0,n.$common.showToast("蓝牙断开");var t=getApp();t.globalData.stateid=1,n.stateid=1}}))},closeBle:function(){console.log("进入6");var n=this;e.closeBLEConnection({deviceId:n.deviceId,success:function(e){n.record=1,n.debounce=!0;var t=getApp();t.globalData.stateid=1,n.stateid=1}})}}};n.default=t}).call(this,t("543d")["default"])}},[["d56d","common/runtime","common/vendor"]]]);