(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/lanya/blebinding"],{"0000":function(t,e,n){"use strict";n.r(e);var s=n("c7c8"),i=n("1be2");for(var o in i)"default"!==o&&function(t){n.d(e,t,(function(){return i[t]}))}(o);n("abf4");var a,c=n("f0c5"),d=Object(c["a"])(i["default"],s["b"],s["c"],!1,null,null,null,!1,s["a"],a);e["default"]=d.exports},"1be2":function(t,e,n){"use strict";n.r(e);var s=n("4c1c"),i=n.n(s);for(var o in s)"default"!==o&&function(t){n.d(e,t,(function(){return s[t]}))}(o);e["default"]=i.a},"22f6":function(t,e,n){"use strict";(function(t){n("ebc2");s(n("66fd"));var e=s(n("0000"));function s(t){return t&&t.__esModule?t:{default:t}}wx.__webpack_require_UNI_MP_PLUGIN__=n,t(e.default)}).call(this,n("543d")["createPage"])},"4c1c":function(t,e,n){"use strict";(function(t){Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var n={data:function(){return{bluetoothStatus:1,newDeviceList:[],lyswitch:!1,date:"选择儿童生日",ipment:"",ipmentid:"",user_phone:"",children_name:"",user_id:"",screenHeight:""}},onLoad:function(t){this.user_phone=t.user_phone},onUnload:function(){this.stopSearch()},onReady:function(){var e=this;t.getSystemInfo({success:function(t){var n=t.windowHeight*(750/t.windowWidth);e.screenHeight=n-120}})},onShow:function(){},methods:{mask:function(){this.lyswitch=!1},mitlog:function(){var e=this;/^1[3456789]\d{9}$/.test(this.user_phone)?this.children_name?this.date?(t.setStorage({key:"user_phone",data:this.user_phone}),t.showToast({title:"绑定中",icon:"none"}),this.$http.glassesEst({url:"users",method:"POST",data:{phone:this.user_phone}}).then((function(t){200==t.data.status?(e.user_id=t.data.data.user_id,e.addChildren()):e.$common.showToast(t.data.message)}))):this.$common.showToast("请选择儿童生日"):this.$common.showToast("请输入姓名"):this.$common.showToast("手机号无效")},addChildren:function(){var t=this;this.$http.glassesEst({url:"children/add",method:"POST",data:{user_id:this.user_id,child_name:this.children_name}}).then((function(e){console.log(e,"用户添加儿童"),200==e.data.status?(t.children_id=e.data.data.childId,t.update_birthday()):t.$common.showToast(e.data.message)}))},update_birthday:function(){var t=this;console.log(this.date,"this.date,"),this.$http.glassesEst({url:"users/update_birthday",method:"PUT",data:{child_id:this.children_id,birthday:this.date}}).then((function(e){200==e.data.status?t.binding():t.$common.showToast(e.data.message)}))},binding:function(){var e=this;this.$http.glassesEst({url:"users/device",method:"POST",data:{child_id:this.children_id,mac_address:this.mac_address,device_type:"v2m"}}).then((function(n){200==n.data.status?(t.hideLoading(),e.$common.showToast("绑定成功"),e.stopSearch()):e.$common.showToast(n.data.message),e.lyswitch=!1}))},mit:function(){this.children_name?(t.showLoading({title:"绑定中"}),this.createUser()):this.$common.showToast("请输入用户姓名之后,点击确定")},bleding:function(e){this.lyswitch=!0,this.ipment=e.name,this.mac_address=e.deviceId,t.setStorage({key:"mac_address",data:this.mac_address})},bindDateChange:function(t){var e=t.detail.value;this.date=e},searchDevice:function(){var t=this;t.bluetoothStatus=2,t.connectDevice()},connectDevice:function(){var e=this;t.openBluetoothAdapter({success:function(t){console.log("调用微信小程序api 打开蓝牙适配器接口"),e.findBlue()},fail:function(e){t.showToast({title:"请打开蓝牙",type:"error",icon:"none"})}})},findBlue:function(){var e=this;t.startBluetoothDevicesDiscovery({allowDuplicatesKey:!1,interval:0,success:function(t){console.log("开启搜索设备"),e.getBlue()}})},getBlue:function(){var e=this;t.onBluetoothDeviceFound((function(){console.log("进行设备搜索"),t.getBluetoothDevices({success:function(n){console.log("搜索到的设备",n),t.hideLoading(),e.newDeviceList=n.devices},fail:function(){console.log("搜索蓝牙设备失败")}})}))},stopSearch:function(){var e=this;e.bluetoothStatus=1,t.stopBluetoothDevicesDiscovery({success:function(t){console.log("连接蓝牙成功之后关闭蓝牙搜索")}})}}};e.default=n}).call(this,n("543d")["default"])},abf4:function(t,e,n){"use strict";var s=n("fb60"),i=n.n(s);i.a},c7c8:function(t,e,n){"use strict";var s;n.d(e,"b",(function(){return i})),n.d(e,"c",(function(){return o})),n.d(e,"a",(function(){return s}));var i=function(){var t=this,e=t.$createElement;t._self._c},o=[]},fb60:function(t,e,n){}},[["22f6","common/runtime","common/vendor"]]]);