(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/lanya/blebinding"],{74:function(t,e,n){"use strict";(function(t,e){var s=n(4);n(26);s(n(25));var i=s(n(75));t.__webpack_require_UNI_MP_PLUGIN__=n,e(i.default)}).call(this,n(1)["default"],n(2)["createPage"])},75:function(t,e,n){"use strict";n.r(e);var s=n(76),i=n(78);for(var o in i)["default"].indexOf(o)<0&&function(t){n.d(e,t,(function(){return i[t]}))}(o);n(80);var a,c=n(32),d=Object(c["default"])(i["default"],s["render"],s["staticRenderFns"],!1,null,null,null,!1,s["components"],a);d.options.__file="pages/lanya/blebinding.vue",e["default"]=d.exports},76:function(t,e,n){"use strict";n.r(e);var s=n(77);n.d(e,"render",(function(){return s["render"]})),n.d(e,"staticRenderFns",(function(){return s["staticRenderFns"]})),n.d(e,"recyclableRender",(function(){return s["recyclableRender"]})),n.d(e,"components",(function(){return s["components"]}))},77:function(t,e,n){"use strict";var s;n.r(e),n.d(e,"render",(function(){return i})),n.d(e,"staticRenderFns",(function(){return a})),n.d(e,"recyclableRender",(function(){return o})),n.d(e,"components",(function(){return s}));var i=function(){var t=this,e=t.$createElement;t._self._c},o=!1,a=[];i._withStripped=!0},78:function(t,e,n){"use strict";n.r(e);var s=n(79),i=n.n(s);for(var o in s)["default"].indexOf(o)<0&&function(t){n.d(e,t,(function(){return s[t]}))}(o);e["default"]=i.a},79:function(t,e,n){"use strict";(function(t){Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var n={data:function(){return{bluetoothStatus:1,newDeviceList:[],lyswitch:!1,date:"选择儿童生日",ipment:"",user_phone:"",mac_address:"",children_name:"",user_id:"",screenHeight:""}},onLoad:function(t){this.user_phone=t.user_phone},onUnload:function(){this.stopSearch()},onReady:function(){var e=this;t.getSystemInfo({success:function(t){var n=t.windowHeight*(750/t.windowWidth);e.screenHeight=n-120}})},onShow:function(){},methods:{mask:function(){this.lyswitch=!1},mitlog:function(){var e=this;/^1[3456789]\d{9}$/.test(this.user_phone)?this.children_name?this.date&&0==isNaN(Date.parse(this.date))?(t.setStorage({key:"user_phone",data:this.user_phone}),t.setStorage({key:"mac_address",data:this.mac_address}),t.showToast({title:"绑定中",icon:"none"}),this.$http.glassesEst({url:"users",method:"POST",data:{phone:this.user_phone}}).then((function(t){200==t.data.status?(e.user_id=t.data.data.user_id,e.addChildren()):e.$common.showToast(t.data.message)}))):this.$common.showToast("请选择儿童生日"):this.$common.showToast("请输入姓名"):this.$common.showToast("手机号无效")},addChildren:function(){var t=this;this.$http.glassesEst({url:"children/add",method:"POST",data:{user_id:this.user_id,child_name:this.children_name}}).then((function(e){console.log(e,"用户添加儿童"),200==e.data.status?(t.children_id=e.data.data.childId,t.update_birthday()):t.$common.showToast(e.data.message)}))},update_birthday:function(){var t=this;console.log(this.date,"this.date,"),this.$http.glassesEst({url:"users/update_birthday",method:"PUT",data:{child_id:this.children_id,birthday:this.date}}).then((function(e){200==e.data.status?t.binding():t.$common.showToast(e.data.message)}))},binding:function(){var e=this;this.$http.glassesEst({url:"users/device",method:"POST",data:{child_id:this.children_id,mac_address:this.mac_address,device_type:"v2m"}}).then((function(n){if(200==n.data.status){t.hideLoading(),t.showToast({title:"绑定成功",duration:2e3}),e.stopSearch();setTimeout((function(){t.navigateBack({delta:1})}),2e3)}else e.$common.showToast(n.data.message);e.lyswitch=!1}))},mit:function(){this.children_name?(t.showLoading({title:"绑定中"}),this.createUser()):this.$common.showToast("请输入用户姓名之后,点击确定")},bleding:function(t){this.lyswitch=!0,this.ipment=t.name,this.mac_address=t.deviceId},bindDateChange:function(t){var e=t.detail.value;console.log(e,"bindDateChange-str"),this.date=e},searchDevice:function(){var t=this;t.bluetoothStatus=2,t.connectDevice()},connectDevice:function(){var e=this;t.openBluetoothAdapter({success:function(t){console.log("调用微信小程序api 打开蓝牙适配器接口"),e.findBlue()},fail:function(e){t.showToast({title:"请打开蓝牙",type:"error",icon:"none"})}})},findBlue:function(){var e=this;t.startBluetoothDevicesDiscovery({allowDuplicatesKey:!1,interval:0,success:function(t){console.log("开启搜索设备"),e.getBlue()}})},getBlue:function(){var e=this;t.onBluetoothDeviceFound((function(){console.log("进行设备搜索"),t.getBluetoothDevices({success:function(n){console.log("搜索到的设备",n),t.hideLoading(),e.newDeviceList=n.devices},fail:function(){console.log("搜索蓝牙设备失败")}})}))},stopSearch:function(){var e=this;e.bluetoothStatus=1,t.stopBluetoothDevicesDiscovery({success:function(t){console.log("连接蓝牙成功之后关闭蓝牙搜索")}})}}};e.default=n}).call(this,n(2)["default"])},80:function(t,e,n){"use strict";n.r(e);var s=n(81),i=n.n(s);for(var o in s)["default"].indexOf(o)<0&&function(t){n.d(e,t,(function(){return s[t]}))}(o);e["default"]=i.a},81:function(t,e,n){}},[[74,"common/runtime","common/vendor"]]]);
//# sourceMappingURL=../../../.sourcemap/mp-weixin/pages/lanya/blebinding.js.map